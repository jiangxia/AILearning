# Pattern | Claude都出4.5了，你还不懂Tool Use的架构革命

上周我在配置MCP服务器时碰到一件怪事。在Claude Desktop里好好的服务器，切换到Claude Code就死活连不上。折腾了半天才发现是工具命名的问题。

这让我意识到，很多人在用Tool Use，但压根不懂背后的架构设计。

我最近深入研究了Tool Use的技术原理。发现了5个关键问题，弄懂这些，你就能理解Claude为什么能"连续工作30小时写代码"。

1. **MCP服务器在Desktop能用，Code连不上，到底怎么回事？**
2. **MCP和LangChain都能给AI加工具，为什么要搞两套？**
3. **Computer Use准确率只有14.9%，这么低还有啥用？**
4. **Claude说能连续工作30小时，SWE-bench拿77.2%，怎么做到的？**
5. **Tool Use调用失败，错误信息看不懂，怎么快速定位？**

---

## Tool Use的本质：从对话到行动

以前的AI对话很简单，你问一个问题，Claude给你一段文字，对话结束。

Tool Use改变了这个模式。现在Claude会先分析你的问题，判断需要什么工具，然后调用工具获取信息。拿到结果后继续思考，如果信息不够，再调用其他工具，最后整合所有信息给你答案。

这就像给Claude装上了手和眼睛。以前他只能动嘴说话。现在他能动手操作电脑，能读文件，能执行代码，能搜索网络。

**说人话就是**：Claude从客服升级成了助理。客服只能回答问题，助理能帮你干活。

Anthropic官方提供了9个核心工具。

先说获取信息的。Web Search搜索互联网，找最新资料。Web Fetch抓取网页内容，深度阅读。MCP Connector连接外部服务器，获取专业数据。

再说写代码的。Code Execution在沙盒里跑代码，验证想法。Text Editor编辑文本文件，修改配置。Bash执行命令行，自动化操作。

最后是更智能的。Computer Use直接操作电脑界面，像人一样点击。Memory Tool跨对话记忆，记住重要信息。PDF Support处理PDF文档，读取复杂格式。

你可能会问，这些工具为什么不像GPT那样做成Plugin市场？

这就要说到MCP协议的设计哲学了。

---

## MCP协议：解决N×M问题

很多人问我，MCP和LangChain都能给AI加工具，为什么要搞两套？

我研究后发现，关键在于定位不同。

LangChain是开发框架，帮你快速搭建AI应用。MCP是标准协议，让服务商和AI应用之间有统一接口。

### LangChain的麻烦

假设你是一个服务提供商，想让AI调用你的服务。用LangChain的话，你要写：

1. 一个Python包装类
2. 一个JavaScript包装类
3. 一个Java包装类
4. 一个Go包装类

因为不同AI应用可能用不同语言开发。你要为每个语言写一套集成代码。

这就是行业里说的N×M问题：

1. N个服务提供商
2. M种编程语言
3. 需要写N×M个集成

举个具体例子。10个服务提供商，支持10种语言，就要写100个集成。这谁受得了？

### MCP的解决方案

MCP的思路是，把乘法变成加法：

1. N个服务商各写1个MCP服务器
2. M种语言各写1个MCP客户端
3. 总共只需N+M个实现

同样是10个服务、10种语言。只需要写20个实现，节省80%工作量。

**说人话就是**：MCP就像USB-C接口。

以前你的手机、电脑、耳机、相机都用不同充电线。现在统一用USB-C。服务商只要实现一个MCP接口，所有支持MCP的AI应用都能用。

这个设计灵感来自LSP（Language Server Protocol）。

LSP解决的是代码编辑器的问题。以前每个编辑器（VS Code、Vim、Emacs）都要为每种语言（Python、JavaScript、Go）写一套语法高亮、自动补全。

现在有了LSP。语言提供方写一个Language Server，编辑器写一个LSP客户端，就能互通。

MCP把同样的思路用在AI工具集成上。

### MCP的核心机制

MCP最聪明的地方是能力声明。

当Claude连接一个MCP服务器时，服务器会告诉他："我有这些工具，每个工具的参数是什么，返回值是什么。"Claude看到这些声明，自己决定要不要调用、怎么调用。

**说人话就是**：就像你找装修公司，对方给你一份详细报价单。上面写着能做什么（刷墙、铺地板）、需要什么参数（面积、材料）、交付什么结果（完工照片）。你看完报价单，自己决定要不要找他们，做哪些项目。

这跟Plugin模式有本质区别。Plugin是"我给你装个插件，你就能干这个"。问题是AI不知道插件能干啥，要靠人类提前告诉他。

MCP是"我告诉你我能干啥，你自己决定什么时候用"。AI有主动权。

举个例子。你配置了一个GitHub MCP服务器，服务器会声明：

```json
{
  "tools": [
    {
      "name": "create_issue",
      "description": "创建GitHub Issue",
      "inputSchema": {
        "type": "object",
        "properties": {
          "repo": {"type": "string"},
          "title": {"type": "string"},
          "body": {"type": "string"}
        }
      }
    }
  ]
}
```

Claude看到这个声明。知道自己可以创建Issue。当你说"帮我在项目里记录这个bug"，Claude会主动调用`create_issue`工具。

这就是MCP比Plugin高明的地方：**标准化的能力声明 + AI自主决策**。

### Desktop能用，Code连不上？

回到开头我遇到的问题。

MCP服务器在Desktop能用，Code连不上。核心原因是协议实现的严格程度不同。

Desktop和Code虽然都支持MCP。但Code要求更严格，特别是工具命名规则。工具名只能包含字母、数字、下划线和破折号。Desktop比较宽松。

如果你的工具名叫`get.user.info`。Desktop能用，Code就会报错`tools.11.custom.name: String should match pattern`。

另外，Desktop用HTTP通信，Code用stdio。环境变量和Node.js版本的差异可能引发问题。

快速排查方法：打开调试模式`claude --debug`，查看`~/.claude/logs/mcp.log`日志。确认工具名是否符合规范，协议版本是否一致。

---

## 30小时自主工作的秘密

Anthropic说Claude Sonnet 4.5能连续工作30小时写代码。这不是营销话术，是真的做到了。

关键技术有三个。

### 1. 反馈循环

Claude Code能持续工作30小时，靠的是一个不断循环的过程。

收集上下文→执行动作→验证结果→重复。

这个循环怎么运转？

Claude会先用Extended Thinking深度分析问题。不是看一眼就开始写代码，而是花几分钟理清思路：这个bug的根因是什么？改哪个文件？会不会影响其他模块？

想清楚之后，制定计划。比如先写测试用例，再修复核心逻辑，运行测试。如果失败就分析日志，调整代码，重新测试。

计划制定后，进入执行阶段。Claude调用工具：克隆代码仓库、编辑文件、运行命令、查看输出。每个动作执行后验证结果，测试通过了吗？报错信息说明什么？

如果结果不对，Claude不会放弃，而是调整策略。测试失败了，就读日志定位问题，修改代码，重新测试。这个循环可以跑几十次，直到问题解决。

**说人话就是**：就像程序员在调试代码。

不是写完就完事，而是写完测试，失败就改。改完再测，直到通过为止。Claude现在能做到这个程度。

### 2. 并行工具调用

传统AI一次只能调一个工具。Claude Sonnet 4.5支持并行调用。

比如你让Claude分析一个项目。他可以同时读`package.json`了解依赖、读`README.md`了解项目结构、读`src/index.js`看主入口。

三个文件并行读取，速度快3倍。

更重要的是推测性搜索。

Claude不是等你明确说"去找X文件"，而是根据上下文主动搜索可能相关的文件。

比如你说"帮我修这个bug"。Claude会同时搜索错误日志相关的代码、搜索测试文件、搜索文档说明。三个搜索并行进行，拿到结果后综合判断从哪里入手。

**说人话就是**：你跟老中医说"最近总头疼"，他不会只看头。而是同时摸脉象、看舌苔、问睡眠，三个线索一起查，然后综合判断是肝火旺还是颈椎病。

这就是为什么Claude能在SWE-bench Verified拿到77.2%准确率。

SWE-bench是真实的软件工程任务：给你一个GitHub Issue，你要找到问题、写代码修复、确保测试通过。这不是简单的"生成一段代码"，而是完整的调试流程。

Claude能做到的原因：反馈循环 + 并行工具调用 + 推测性搜索。

### 3. Computer Use的视觉感知

Computer Use是最酷的工具。Claude可以"看"你的屏幕、"点击"按钮、"输入"文字。

技术实现上，Claude每次动作前会截屏。用Vision能力分析当前界面，决定下一步操作。

比如看到一个登录表单。Claude会分析出需要输入用户名和密码。然后移动鼠标到用户名输入框，再截屏确认光标位置。接着输入用户名。

密码和登录按钮的操作也是同样的流程。

这个流程是纯视觉驱动的。Claude不需要API，不需要知道网页的HTML结构。只要能"看"就能操作。

当然，准确率还不高。官方数据显示，Claude在Computer Use基准测试中准确率14.9%，GPT-4是7.7%。

为什么这么低还有用？

因为Computer Use不是为了"全自动"设计的。而是为了"辅助人类"。

什么场景适合用？

企业自动化：自动填表单、批量处理数据。70%的任务能自动完成，剩下30%人工介入，效率已经大幅提升了。

QA测试：模拟用户操作、生成测试用例。即使偶尔出错，也比手工快得多。

辅助开发：操作GUI工具，比如数据库管理界面。不需要写脚本，直接点击就行。

这些场景不需要100%准确率。

---

## 快速解答

我们回顾一下开头的5个问题。

**MCP服务器在Desktop能用，Code连不上**。最常见原因是工具命名不符合规范。Code要求工具名只能包含字母、数字、下划线和破折号，Desktop比较宽松。打开`~/.claude/logs/mcp.log`查看具体错误信息。

**MCP和LangChain的区别**在于定位。LangChain是开发框架，帮你快速搭建AI应用。MCP是标准协议，让服务商和AI应用之间有统一接口。MCP解决的是N×M问题：10个服务、10种语言，只需20个实现，而不是100个。这跟USB-C统一充电接口是一个道理。

**Computer Use准确率只有14.9%**，但这不影响实用价值。因为Computer Use不是为了100%自动化设计的，而是为了辅助人类。企业用它自动填表单，70%成功率就能节省大量时间。QA测试用它生成测试用例，即使偶尔出错，也比手工快得多。

**Claude能连续工作30小时**，靠的是反馈循环。收集上下文→执行动作→验证结果→重复。加上并行工具调用和推测性搜索，Claude能同时读取多个文件、主动搜索相关代码。这就是为什么在SWE-bench测试中，Claude能拿到77.2%准确率。

**Tool Use调用失败**时，错误信息通常指向三个问题：工具参数不对、工具返回值格式不对、或者工具本身报错。快速定位方法：开启调试模式`claude --debug`，查看完整工具调用日志，确认输入输出是否符合schema声明。

---

## 深入交流

想要深入交流AI实践经验？欢迎关注，一起探讨AI时代的无限可能！

---

> ### 关于本人 ｜ 黄彦湘
> 深耕互联网行业9年，专注前端开发技术方向，现为广州执业律师，同时兼备专利代理师资质。基于丰富的技术背景和法律实践经验，现为深度实践（Deepractice）社区核心贡献者，致力于推动AI深度实践在法律、小说创作等多元领域的创新应用与探索。
> **全网同名**：明易AI实践

---
