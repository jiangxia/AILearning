# Claude Code 高阶使用技巧

本内容梳理了Claude Code的安装、核心功能、高级特性、集成能力及可视化工具等方面的使用技巧，旨在提供一份全面的参考资料。

## 一、 Claude Code 基础设置与启动

Claude Code是一款流行的AI编程工具，以下为其基础设置与启动方式：

*  **前提条件**:
  *  确保已安装 **Node.js**。

*  **安装步骤**:
  1. 复制Claude Code的安装命令。
  2. 打开命令行窗口，执行安装命令。
  3. 安装完成后，使用`cd`命令进入需要编写代码的项目目录。

*  **启动方式**:
  *  **官方账户登录**: 若为Claude Code官网Pro或Max级别用户，直接输入命令`Claude`启动，并选择第一项前往官网登录。
  *  **API接入 (通过Claude Code Router)**:
    *  利用开源项目 **Claude Code Router (CCR)**，可将任意大型模型API接入Claude Code。
    *  启动命令为`CCR Code`。
    *  关于CCR的免费使用方式及具体操作，可参考相关资料。

## 二、 核心命令与上下文管理

以下为Claude Code在日常交互中至关重要的命令及其功能：

### 1. 项目与上下文初始化

*  **`/init`**:
  *  **功能**: 命令Claude Code通读整个文件夹中的所有文件，深入分析当前项目。
  *  **效果**: 将学习到的项目知识保存到当前目录下的 **`Claude.md`** 文件中。
  *  **作用**: 后续与Claude Code的所有对话都将以该文件作为上下文，有助于AI更快理解项目。
  *  **自定义**: 用户可以手动修改`Claude.md`文件，补充重要信息（例如CSS框架知识），以提升AI理解的精准度和速度，类似于Cursor工具中的Cursor Rule。

### 2. 对话上下文优化

*  **`/compact`**:
  *  **功能**: 压缩对话上下文。
  *  **效果**: 排除之前对话中无关紧要的内容，有效提高AI的专注力，并显著降低Token消耗。
  *  **使用**: 可以在命令后输入具体指令，指导AI如何进行压缩。

*  **`/clear`**:
  *  **功能**: 清除与AI的对话记录。
  *  **使用时机**: 每次开启新任务前应使用此命令，以保持上下文的清洁。
  *  **作用**: 有助于AI更专注地执行新任务。

### 3. 模型思考深度控制

*  **`think`**, **`think hard`**, **`think harder`**, **`ultra think`**:
  *  **性质**: 这是Claude Code官方支持的，用于控制模型思考长度的指令，并非提示词技巧。
  *  **强度**: 四种指令强度逐级递增。
  *  **应用**: 在开始需要复杂推理的任务之前，可以添加这些思考提示词，以加大AI的思考深度。

### 4. 命令行交互与记忆模式

*  **`!` (感叹号)**:
  *  **功能**: 将对话窗口切换为命令行模式。
  *  **作用**: 允许执行临时命令行命令（例如`npm install`），无需额外开启窗口。
  *  **优势**: 命令的执行结果和过程会自动加入Claude Code的对话上下文，使AI能够从历史记录中了解依赖安装情况，避免重复安装。

*  **`#` (井号)**:
  *  **功能**: 进入记忆模式。
  *  **效果**: 用户输入的后续内容将被Claude Code以文件形式记录，并转化为AI的长期记忆。
  *  **记忆存储位置**:
    *  **项目级别**: 直接保存在当前项目的`cloud.md`文件中。
    *  **用户级别**: 保存在Claude Code的配置文件中（例如，Windows系统路径为`C:\Users\\.cloud\cloud.md`）。用户级别的记忆对所有文件夹和项目生效，作为Claude Code的全局记忆或系统提示词。

## 三、 IDE集成与非交互模式

### 1. IDE集成

*  **`/IDE`**:
  *  **前提**: 在常用IDE工具（如VSCode）中安装 **Claude Code for VSCode** 插件。
  *  **步骤**: 输入`/IDE`，选择对应的IDE（如VSCode），完成集成。
  *  **主要功能**:
    *  **代码感知**: Claude Code能够感知并读取在IDE中选中的代码，用户可询问AI关于选中代码的功能。
    *  **代码修改对比**: 当Claude Code进行代码修改时，会在IDE中弹出修改前后对比页面，直观展示差异，用户可在Claude Code中选择是否接受这些修改。

### 2. 非交互模式

*  **`cloud -p <问题>`** (或 **`CCR Code -p <问题>`** 当使用Claude Code Router时):
  *  **模式**: 开启临时的、一次性的非交互式对话。
  *  **过程**: Claude Code会在后台进行思考，调用工具处理问题，完成后将结果打印输出。
  *  **应用**: 将Claude Code转变为命令行中的AI智能助手。

## 四、 模型上下文协议 (MCP)

### 1. MCP 定义与原理

*  **全称**: Model Context Protocol (模型上下文协议)。
*  **作用**: MCP服务（或称MCP Server）作为AI与外部工具之间的中间层，代替人类访问并操作外部工具。
*  **原理**: 旨在帮助AI查找最新代码文档并进行交互。

### 2. MCP 安装与管理

*  **安装MCP (`cloud mcp add <名称>`)**:
  *  **示例**: 安装`context7`（一个用于查找最新代码文档的MCP Server）。
  *  **步骤**:
    1. 退出Claude Code。
    2. 执行命令`cloud mcp add context7`。
    3. 执行MCP Server的启动命令（例如`mpx -- <启动参数>`）。
  *  **安装范围**:
    *  **项目级别**: 默认安装，仅在当前项目下生效。
    *  **用户级别**: 可通过添加参数`--scope user`进行安装，对所有项目生效。

*  **查看已安装MCP**: 在Claude Code中输入`/mcp`，回车即可查看。

*  **使用示例**:
  1. 要求AI使用`context7`查找如何配置Tailwind 4。
  2. 要求AI使用`context7`将当前Tailwind V3项目升级到V4。
  3. AI会调用MCP工具查找文档，整理升级步骤，并逐个文件进行修改，最终完成项目升级。

*  **删除MCP (`cloud mcp remove <名称>`)**:
  *  **步骤**: 退出Claude Code，执行命令`cloud mcp remove context7`。

*  **远程调用MCP**:
  *  **SSE协议**: `cloud mcp add <名称> --protocol sse --url <服务地址>`
  *  **Streamable HTTP协议**: `cloud mcp add <名称> --protocol streamable-http --url <服务地址>`
  *  **示例**: 配置一个Nyan数据库的MCP，使AI能够调用Nyan的MCP查找数据库中的表。

## 五、 权限管理

### 1. 精细化权限控制

*  **`/permissions`**:
  *  **功能**: 自定义Claude Code调用工具的规则。
  *  **`allow` (允许)**:
    *  **用途**: 将工具添加到允许列表后，Claude Code调用这些工具时无需再征求用户同意，可自动执行。
    *  **规则示例**: `bash(git commit)` 表示允许自动执行Git commit命令。
    *  **存储级别**: 配置可保存为项目设置或用户设置。
    *  **MCPs**: 可将MCP Server（例如`mcp__Nyan`）放入允许列表。
  *  **`deny` (禁止)**:
    *  **用途**: 定义Claude Code禁止使用的工具。
    *  **内置工具**: 可在Claude Code官方文档中查找所有内置工具的名称。
    *  **MCPs**: 可以禁止特定MCPs的使用。

### 2. 高权限模式

*  **`--dangerously-skip-permissions`**:
  *  **使用方式**: 在启动Claude Code时添加此参数（例如`cloud --dangerously-skip-permissions`或`CCR Code --dangerously-skip-permissions`）。
  *  **效果**: 赋予Claude Code最高权限，使其在使用任意工具和执行任意命令时，无需申请权限即可自动执行。

## 六、 自定义命令与钩子 (Hooks)

### 1. 自定义命令

*  **位置**:
  *  **项目级别**: 项目目录下的 `.cloud/commands/` 文件夹。
  *  **用户级别**: Claude Code配置目录下的 `commands/` 文件夹（对所有项目生效）。

*  **创建**: 在`commands`文件夹中创建文件，文件名即为命令名称。
  *  **示例**: 创建`codereview.md`文件作为代码审核命令。

*  **内容**: 使用自然语言描述命令需要执行的任务。

*  **参数传递**: 使用 `$arguments` 作为传入参数的占位符。
  *  **示例**: 命令可以接收一个分支名参数，对比该分支与主分支的差异并提出审核意见。

*  **执行**: 在Claude Code中输入`/`即可找到自定义命令，后接空格并输入参数（例如`/codereview Telwyn_four_branch`）。

*  **结果**: Claude Code会执行相应的Git diff命令，并给出完整的Code Review意见。

### 2. 钩子 (Hooks)

*  **功能**: 让Claude Code在工作流程的特定节点自动执行某些操作。

*  **配置文件**: `.cloud/settings.json` 或优先级更高的 `.cloud/settings.local.json`。

*  **配置示例**:
  *  **定义时机**: `hooks` 中定义执行时机，例如`Post to use`（工具调用完成后）。
  *  **匹配器 (`Matcher`)**: 指定触发钩子的工具类型，例如文件修改工具。
  *  **命令内容**: 定义要执行的命令，例如运行`npx prettier check`来检查代码格式。

*  **工作流程**: AI修改代码后，钩子立即触发代码格式检查，若发现错误，Claude Code会自动修复。

*  **触发事件**: Claude Code官方文档列举了多种触发事件，可用于配置更多辅助开发的功能。

## 七、 子代理 (Subagents)

*  **概念**: 类似于编程中的子线程，允许Claude Code在后台开启多个子任务并行执行。

*  **优势**:
  *  **提高效率**: 并行执行任务，加快完成速度。
  *  **提高可预测性**: 每个Subagent专注于一个小功能，结果更可控。
  *  **提高成功率**: 正确拆解复杂任务，提升任务完成成功率。

*  **创建 (`/agents` -> `create`)**:
  *  **存储级别**: 可选择项目级别或用户级别。
  *  **配置**:
    *  描述: 自然语言描述Subagent的任务和期望结果（例如，代码审核大师，比较Git分支差异并提出审核意见）。
    *  工具权限: 赋予Subagent所需工具的权限。
    *  模型: 选择使用的模型。
    *  颜色: 分配一个代表颜色。
  *  **配置文件**: 生成的配置文件存储在项目目录中。

*  **执行过程**:
  1. Claude Code接收任务后，根据Subagent的配置自动拆分出子任务。
  2. 子任务分配给不同的Subagent并行执行。
  3. 每个Subagent获取一份执行其子任务所需的精简上下文，避免被主对话污染，提高专注力。
  4. 所有Subagent执行完成后，主Agent整合所有结果并给出完整回答。

*  **应用**: 可同时执行代码审核和天气查询等互不相关的任务，提高多任务处理能力。

## 八、 GitHub集成

### 1. GitHub CLI 工具

*  **工具**: GitHub CLI 是一款命令行工具，Claude Code可借助它执行所有GitHub操作。
*  **安装**: 下载并安装对应操作系统的GitHub CLI。
*  **验证**: 执行`gh repo list`可验证安装和认证状态。

### 2. 集成应用场景

*  **示例**: 修复GitHub Issue并推送至仓库。
  1. 要求Claude Code查看GitHub Issue内容（例如"缺少提交按钮"）。
  2. Claude Code读取Issue并进行本地代码修复。
  3. 创建一个全新的修复分支。
  4. 将修复分支推送到GitHub。

*  **结果**: Claude Code成功读取GitHub Issue，在本地完成代码修改，并将代码推送到GitHub，形成完美的闭环。

## 九、 历史对话与状态管理

### 1. 历史对话回溯

*  **`/resume`**:
  *  **功能**: 查找并回溯之前的历史话题。
  *  **操作**: 选择历史话题后，按两下`ESC`键可跳转到对话中的具体某句话之前，继续对话。
  *  **局限**: 仅能回退对话内容，不能回退代码改动。

### 2. 对话与代码同步回退

*  **`ccundo` (开源项目)**:
  *  **功能**: 同时回退对话内容和代码状态。
  *  **安装**: 需先安装`ccundo`工具。
  *  **使用**:
    *  `ccundo list`: 列出之前的所有对话记录及其编号。
    *  `ccundo <编号>`: 将对话和代码内容同时回退到指定节点，继续工作。

### 3. 对话内容导出

*  **`/export`**:
  *  **功能**: 将当前对话内容复制到剪贴板。
  *  **用途**: 可将对话内容保存为文件，或粘贴给其他AI（例如ChatGPT）进行交叉验证或进一步分析。

## 十、 可视化界面：Claudia

### 1. Claudia 简介

*  **性质**: 一个基于Claude Code打造的桌面可视化应用。
*  **社区**: 在GitHub上获得大量关注。
*  **获取**: 原始项目不提供安装包，需从源码编译。社区有开发者基于该项目提供了预编译的安装包版本，可在其Forks中找到Star数量较高的项目下载。

### 2. Claudia 安装与配置

*  **安装**: 下载并安装对应操作系统的安装包。

*  **登录配置**:
  *  **官方账户**: 若Claude Code使用官网账户登录，Claudia可直接使用。
  *  **API/CCR启动**: 若Claude Code通过API或Claude Code Router启动，需在Claudia设置中配置API环境变量：
    *  `Anthropic Auth Token`: 填写Claude Code控制台`Status`中显示的Token值。
    *  `Anthropic Base URL`: 填写控制台中对应的URL。

### 3. Claudia 主要功能

Claudia提供了命令行中Claude Code功能的图形化界面操作方式，并新增了部分特性：

*  **历史项目与对话管理**: 方便管理历史项目及对话记录。
*  **新建对话**: 直接选择文件夹开始新的对话。
*  **模型思考长度调整**: 左下角可调整AI的思考长度。
*  **可视化操作**:
  *  创建MCP。
  *  编辑`cloud.md`系统提示词。
  *  查看使用情况仪表板。
  *  配置Subagent。
  *  在设置中添加环境变量。
  *  添加Hooks。
  *  添加自定义命令。
*  **多标签页功能**: 更方便地管理历史记录和对话上下文。
*  **时间导航线 (检查点)**:
  *  **功能**: 允许用户创建文件系统状态和对话历史的检查点。
  *  **操作**:
    1. 点击`create checkpoint`创建检查点。
    2. AI进行文件修改（例如删除文件）。
    3. 点击`restore`检查点。
  *  **优势**: 能够同时回退文件改动和之前的对话历史，将所有状态还原到检查点的时间点，弥补了原生Claude Code无法回退文件改动的不足。
